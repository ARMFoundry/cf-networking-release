---
netman_overrides:
  releases:
  - name: netman
    version: latest
  driver_templates:
  - name: garden-cni
    release: netman
  - name: cni-flannel
    release: netman
  - name: netmon
    release: netman
  - name: vxlan-policy-agent
    release: netman
  properties:
    vxlan-policy-agent:
      policy_server_url: http://policy-server.service.cf.internal:4002
      garden_address: 127.0.0.1:7777
      garden_protocol: tcp
    garden-cni:
      cni_plugin_dir: /var/vcap/packages/flannel/bin
      cni_config_dir: /var/vcap/jobs/cni-flannel/config/cni
    cni-flannel:
      etcd_endpoints:
      - http://cf-etcd.service.cf.internal:4001
    policy-server:
      database:
        connection_string: postgres://networkpolicyadmin:admin@10.244.0.30:5524/networkpolicydb?sslmode=disable
        type: postgres
      skip_ssl_validation: true
      uaa_client_secret: network-policy-secret
      uaa_url: https://uaa.bosh-lite.com
  garden_properties:
    network_plugin: /var/vcap/packages/runc-cni/bin/garden-external-networker
    network_plugin_extra_args:
    - --configFile=/var/vcap/jobs/garden-cni/config/adapter.json
  jobs:
  - name: policy-server
    instances: 1
    persistent_disk: 256
    templates:
    - name: policy-server
      release: netman
    - name: route_registrar
      release: cf
    - name: consul_agent
      release: cf
    - name: metron_agent
      release: cf
    resource_pool: database_z1
    networks:
      - name: diego1
    properties:
      nats:
        machines:
        - 10.244.0.6
        password: nats
        port: 4222
        user: nats
      metron_agent:
        zone: z1
      route_registrar:
        routes:
        - name: policy-server
          port: 4002
          registration_interval: 20s
          uris:
          - api.bosh-lite.com/networking
      consul:
        agent:
          services:
            policy-server:
              name: policy-server
              check:
                interval: 5s
                script: /bin/true
